<!DOCTYPE html>
<html lang="en">
<head>
<title>Validate a Provider HPI-I Number</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="content-type" content="text/html">
<meta charset="utf-8">
</head>
<body>
<h1>Validate a Provider HPI-I Number</h1>

<h3>Enter a Provider HPI-I Number, then hit Submit to get it validated</h3>
<h4>Must be 16 digits</h4>
<form name="ProviderHPIINumberForm" >
	<label for="formInput">Provider HPI-I Number:</label><input type="text" id="formInput" name="providerHPIINumber">
	<label for="formSubmit"></label><input type="button" id="formSubmit" value="Submit" onclick="validateHPIIForm()">
</form>

<h3>Report</h3>
<p id="validation"></p>

<script>


function checkProviderHPIINumber(providerHPIINumber) {
	if (providerHPIINumber.length < 16) {					// check length
		return "Not enough characters";
	}
	if (providerHPIINumber.length > 16) {					// check length
		return "Too many characters";
	}
	if (Number.isNaN(Number(providerHPIINumber))) {							// check starts with 10 digits
		return "HPI-I number is not a number";
	}
	if (providerHPIINumber.substring(0, 6) != "800361") {
		return "Invalid initial digits - not 800361";
	}
	var thisSum = 0;
	for(var i = 14; i > -1; i -= 2) {
		digit = parseInt(providerHPIINumber.substring(i, i + 1)) * 2;
		thisSum += Math.trunc(digit / 10);
		thisSum += digit  % 10;
	}
	for(var i = 13; i > -1; i -=  2) {
		digit = parseInt(providerHPIINumber.substring(i, i + 1));
		thisSum += digit;
	}
	checkSum = ((thisSum * 9) % 10);
	if (checkSum != parseInt(providerHPIINumber.substring(15, 16))) {
		return "Invalid checksum digit";
	}
	return "";
}


function validateHPIIForm() {
	var providerHPIINumber = document.forms["ProviderHPIINumberForm"]["providerHPIINumber"].value;
	var valid = checkProviderHPIINumber(providerHPIINumber);
	if (valid == "") {
		document.getElementById("validation").innerHTML = "Is Valid";
	} else {
		document.getElementById("validation").innerHTML = "Is Not Valid: " + valid;
	}
}

</script>

</body>
</html>
